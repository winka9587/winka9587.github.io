---
title: llava in kaggle notebook 
date: 2025-04-21 08:55
category: 
author: 
tags: []
summary: 
---

## kaggle "no internet" ä¸‹pip å®‰è£…

é¢„å…ˆå°†ä¾èµ–çš„åŒ…ä¸‹è½½å¥½ï¼Œä¸Šä¼ ä¸ºdataset

ä½¿ç”¨

## å¾…éªŒè¯æ€è·¯

1. ä½¿ç”¨DINOv2+BLIPæ··åˆfusionæå‡èšç±»ç²¾åº¦(æœ‰æ•ˆæœä½†æå‡ä¸å¤§)

2. å…¨å±€PCAåˆ‡æ¢ä¸ºç‹¬ç«‹featureå¯¹åº”ç‹¬ç«‹PCAï¼ˆä¸”train_datasetè®­ç»ƒPCA, è€Œétest_datasetä¸´æ—¶fitï¼‰

3. mst æ„å»ºå›¾åƒé—´æŸ¥è¯¢èŠ‚ç‚¹, å¿«é€Ÿèšç±»åŠæ£€ç´¢

4. åœºæ™¯ç‹¬ç«‹memory, å…±äº«Decoderï¼ˆå¯¹ç§°ç»“æ„ï¼‰å¹¶è¾“å‡ºpose

5. å¦‚æœæ˜¯éåºåˆ—è¾“å…¥, é‚£ä¹ˆå›¾åƒé—´æ˜¯ç‹¬ç«‹çš„ã€‚ä½†æ˜¯å¦‚æœæ˜¯åºåˆ—è¾“å…¥çš„è¯, moveè¿ç»­æ€§æ˜¯å¦åº”è¯¥è¢«è€ƒè™‘? åœ¨decoderä¸­åº”è¯¥è¢«åŒ…å«åœ¨å†…ã€‚

## å…¶ä»–

~~~
/data5/cxx/workspace/llava-model-checkpoints


  506  mkdir -p llava-packages
  507  pip download   transformers accelerate sentencepiece bitsandbytes   -d llava-packages
  512  git clone https://github.com/haotian-liu/LLaVA.git llava-code/LLaVA
  513  cd llava-code/LLaVA
  514  rm -rf .git  # åˆ é™¤ .git é¿å…æµªè´¹ç©ºé—´
  518  mkdir -p
  520  mkdir -p llava-model-checkpoints/
  521  ls
  522  cd llava-model-checkpoints/
    ä¸‹è½½huggingfaceçš„æ‰€æœ‰å†…å®¹https://huggingface.co/liuhaotian/llava-v1.5-7b/tree/main
~~~

æ­¤åçš„ç»“æ„å¦‚ä¸‹ï¼š

~~~
llava-offline/
â”œâ”€â”€ llava-packages/
â”‚   â”œâ”€â”€ transformers-4.51.3-py3-none-any.whl
â”‚   â””â”€â”€ ...
â”œâ”€â”€ llava-code/
â”‚   â””â”€â”€ LLaVA/
â”‚       â”œâ”€â”€ llava/
â”‚       â”œâ”€â”€ setup.py
â”‚       â””â”€â”€ ...
â””â”€â”€ llava-model-checkpoints/
    â””â”€â”€ snapshots/
        â””â”€â”€ 1234567890abcdef/
            â”œâ”€â”€ config.json
            â”œâ”€â”€ pytorch_model-00001-of-00002.bin
            â””â”€â”€ ...
~~~

å°†llava-offlineå‹ç¼©ä¸ºä¸€ä¸ªå•ç‹¬çš„zipæ–‡ä»¶, ä¸Šä¼ ä¸ºä¸€ä¸ªå•ç‹¬çš„kaggle Dataset.

# é—®é¢˜åˆ—è¡¨ & kaggleå‘½ä»¤

## llava

### ä½¿ç”¨ç‰¹å®šçš„transformersç‰ˆæœ¬

~~~
!pip install transformers==4.36.2
~~~

https://www.kaggle.com/competitions/chaii-hindi-and-tamil-question-answering/discussion/267694#1488794

å¿…é¡»åœ¨kaggle notebookçš„ç¬¬ä¸€ä¸ªcellä¸­æ‰§è¡Œã€‚å¦‚æœéœ€è¦ç¦»çº¿å®‰è£…ï¼Œå‚è€ƒï¼šhttps://www.kaggle.com/c/severstal-steel-defect-detection/discussion/113195


## ç»“æœ

å®˜æ–¹æä¾›çš„P100å’ŒT4*2éƒ½ä¸èƒ½æ»¡è¶³æ¡ä»¶ï¼ŒT4*2å¯ä»¥åˆ†å¸ƒåˆ°ä¸¤å¼ å¡ä¸Šè¿è¡Œï¼Œä½†æ˜¯æˆ‘æ‹‰å–çš„æœ€æ–°é•œåƒæœ‰bugï¼ŒåŒå¡llavaä¼šè¿è¡Œå¤±è´¥ã€‚

![](/assets/img/2025-04-24-10-24-02.png)

> 
> 1.appear to be engaged in conversation or listening to a speaker. The room has a dining table in the background, which occupies a significant portion of the space. There are also two chairs visible in the room, one near the center and the other towards the right side. The overall atmosphere of the image suggests a collaborative and social environment.
>
> 2.further back. The individuals are of varying heights and positions, indicating that they might be of different ages or genders. They all appear to be focused on the same direction, possibly anticipating an announcement or event. The overall atmosphere of the image suggests that the people are organized and orderly, waiting patiently in line for whatever is about to happen.
>

## ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·

~~~
kaggle competitions submissions -c image-matching-challenge-2025
fileName        date                        description                                                                                    status                     publicScore  privateScore
--------------  --------------------------  ---------------------------------------------------------------------------------------------  -------------------------  -----------  ------------
submission.csv  2025-05-29 09:02:24.747000  Notebook MASt3R-Baseline+localBA | Version 4                                                   SubmissionStatus.COMPLETE
submission.csv  2025-05-29 07:17:25.817000  Notebook mst+DBSCAN_cluster_improve | Version 8                                                SubmissionStatus.COMPLETE  13.05
submission.csv  2025-05-29 07:01:17.557000  Notebook Baseline2-param + cluster improve | Version 1                                         SubmissionStatus.PENDING
submission.csv  2025-05-29 06:35:05.563000  Notebook MASt3R-Baseline+localBA | Version 3                                                   SubmissionStatus.COMPLETE
submission.csv  2025-05-28 13:27:01         Notebook MASt3R-Baseline+localBA | Version 2                                                   SubmissionStatus.COMPLETE
submission.csv  2025-05-28 09:08:02         Notebook Baseline-Test:DINO+ALIKED+LightGLUE a667f0 | Version 1                                SubmissionStatus.COMPLETE  26.84
submission.csv  2025-05-28 08:46:47         Notebook MASt3R-Baseline+localBA | Version 1                                                   SubmissionStatus.COMPLETE
~~~


# Baseline test

æµ‹è¯•[OCTAVI GRAUæä¾›çš„baseline](https://www.kaggle.com/code/octaviograu/baseline-dinov2-aliked-lightglue)

DINOv2 æå–å…¨å±€æè¿°ç¬¦ï¼Œç­›é€‰å›¾åƒå¯¹ï¼Œshortlisting

ALKIED æ£€æµ‹å±€éƒ¨ç‰¹å¾ç‚¹ï¼Œä½¿ç”¨LightGlueè¿›è¡Œå±€éƒ¨ç‰¹å¾åŒ¹é…ã€‚

RANSAC+PnPï¼ˆpycolmapï¼‰è®¡ç®—ç›¸å¯¹æ—‹è½¬å’Œä½ç§»ï¼Œä¼°è®¡ä¸‰ç»´å§¿æ€

## ç›®å‰çš„baselineé—®é¢˜

1. åŠ è½½å›¾åƒå¤ªæ…¢, ä¸»è¦é—®é¢˜å‡ºåœ¨å›¾åƒå¯¹çš„æ„å»ºä¸Š$C^2_n$çš„å¤æ‚åº¦å¤ªé«˜äº†ã€‚åœ¨kaggle notebookä¸Šå¦‚æœå°è¯•åŠ è½½æ‰€æœ‰çš„trainæ•°æ®ç”šè‡³ä¼šå¯¼è‡´è¶…è¿‡å†…å­˜ä¸Šé™ã€‚

èƒ½å¦åˆ©ç”¨memoryå‡å°å¤æ‚åº¦? ä½†é€Ÿåº¦ä¸æ˜¯æœ€å…³é”®çš„é—®é¢˜

2. èšç±»ç²¾åº¦ä¸å¤Ÿ

3. pose estimation ç²¾åº¦ä¸å¤Ÿ


# å¾…éªŒè¯çš„è§£å†³æ€è·¯

ä½¿ç”¨dinov2çš„global descå’ŒBLIPè¿›è¡Œèšç±»

å°†èšç±»ç»“æœä¸´æ—¶ä¿å­˜ï¼ŒæŒ‰å°çš„datasetåŠ è½½å¹¶ä½¿ç”¨memoryæœºåˆ¶è¿›è¡ŒåŒ¹é…ã€‚

MUSt3Ræåˆ°ä½¿ç”¨xformerå¿«é€Ÿè®¡ç®—æ³¨æ„åŠ›ï¼Ÿ



## æŒ‡æ ‡è®°å½•

### baseline

~~~
stairs: score=6.25% (mAA=3.33%, clusterness=50.00%)

imc2023_haiper: score=0.00% (mAA=0.00%, clusterness=0.00%)
imc2023_heritage: score=0.00% (mAA=0.00%, clusterness=0.00%)
imc2023_theather_imc2024_church: score=52.24% (mAA=35.36%, clusterness=100.00%)
imc2024_dioscuri_baalshamin: score=62.98% (mAA=48.61%, clusterness=89.41%)imc2024_lizard_pond: score=0.00% (mAA=0.00%, clusterness=0.00%)
pt_brandenburg_british_buckingham: score=0.00% (mAA=0.00%, clusterness=0.00%)
pt_piazzasanmarco_grandplace: score=0.00% (mAA=0.00%, clusterness=0.00%)
pt_sacrecoeur_trevi_tajmahal: score=0.00% (mAA=0.00%, clusterness=0.00%)
pt_stpeters_stpauls: score=0.00% (mAA=0.00%, clusterness=0.00%)
amy_gardens: score=30.90% (mAA=18.27%, clusterness=100.00%)
fbk_vineyard: score=28.03% (mAA=24.19%, clusterness=33.33%)
ETs: score=31.67% (mAA=25.00%, clusterness=43.18%)
stairs: score=6.25% (mAA=3.33%, clusterness=50.00%)
~~~

### DINO+BLIP å…±ç”¨testé›†æ‹ŸåˆPCAæ¨¡å‹

~~~
amy_gardens: score=33.23% (mAA=19.92%, clusterness=100.00%)
fbk_vineyard: score=29.50% (mAA=26.46%, clusterness=33.33%)
ETs: score=31.67% (mAA=25.00%, clusterness=43.18%)
stairs: score=5.26% (mAA=2.78%, clusterness=50.00%)
~~~

### DINO+BLIP fusion(normalize+ç‹¬ç«‹PCA model)

~~~
amy_gardens: score=30.54% (mAA=18.02%, clusterness=100.00%)
ETs: score=36.63% (mAA=30.77%, clusterness=45.24%)
~~~

å¾ˆå¥‡æ€ªï¼Œ amy_gardensçš„èšç±»ä¸€ç›´æ˜¯100%, å±äºéå¸¸ç®€å•çš„é‚£ç§, ä½†æ˜¯åŒ¹é…çš„ç²¾åº¦åè€Œé™ä½äº†ã€‚

## å°è¯•è¿‡çš„æ–¹æ¡ˆ

| Result | Submission Result (score) |  Strategy-demo | ç»“æœåŠåˆ†æ | æ˜¯å¦ç»§ç»­æµ‹è¯• |
|----------|----------|----------|----------|----------|
| æ•ˆæœæœ€å¥½ | 33.92 |DINOv2+BLIPï¼ŒPCAåçº¿æ€§æ‹¼æ¥ç‰¹å¾è¿›è¡Œèšç±»| BLIPçš„å¼•å…¥èƒ½å¤Ÿå¸¦æ¥æå‡ **ç›®å‰çš„çº¿æ€§èåˆå¯ä»¥æ”¹è¿›**| :heavy_check_mark: |
|å¤±è´¥| N/A |llavaæè¿°å›¾åƒ, æå–å…¨å±€ç‰¹å¾ä»¥æå‡èšç±»æ•ˆæœ| 7Bæ¨¡å‹è¯†åˆ«å›¾åƒèƒ½åŠ›å¾ˆå·® | :x: |
|å¤±è´¥| 18.36 |mstèšç±»ï¼ˆè®­ç»ƒé›†èšç±»æ•ˆæœæå‡æ˜æ˜¾, ä½†æ˜¯æµ‹è¯•é›†æ•ˆæœå¾ˆå·®ï¼Œä¸”æ€»å¾—åˆ†æ‰è½| é—®é¢˜ä¸åœ¨èšç±»è¿™è¾¹, åŒ¹é…ç²¾åº¦ä¸å¤Ÿå¯¼è‡´æ€»ç»“å¾—åˆ†ä¸‹é™ | :heavy_check_mark: |
|å¤±è´¥| N/A |MASt3R| ç²¾åº¦ä¸å¤Ÿ | :x: |
|å¤±è´¥| N/A |VGGT| ç²¾åº¦ä¸å¤Ÿ | :x: |
|å¤±è´¥| N/A |(3)å’Œ(4) + glomap BA| **é—®é¢˜åº”è¯¥åœ¨è¾“å…¥colmapçš„ç‰¹å¾éƒ¨åˆ†ï¼Œå…¶ç²¾åº¦ä¸å¤Ÿ** | :heavy_check_mark: |
|å¤±è´¥| 15.13 |ä¸»åŠ¨é™ä½(2)çš„èšç±»ç²¾åº¦ä»¥å›¾æå‡æŒ‡æ ‡ã€‚ç”Ÿæˆç½®ä¿¡åº¦, dropoutåŒ¹é…/BAç½®ä¿¡åº¦ä½çš„å›¾åƒ| å¯ä¿®æ”¹drop condition | :heavy_check_mark: |
|æ•ˆæœç¬¬äºŒå¥½ | 32.64 | PCA model ç»´åº¦ä»192 -> 384| å¯è°ƒæ•´å‚æ•°æµ‹è¯• | :heavy_check_mark: |

## Test data load

ç†è§£é”™è¯¯äº†.

**è¿™ç§éšè—æ•°æ®é›†çš„æ¯”èµ›æäº¤åçš„æµç¨‹æ—¶ï¼Œä½ æäº¤çš„notebookå…ˆåŠ è½½ä»–æä¾›çš„å…¬å¼€testæ•°æ®è¿›è¡Œæµ‹è¯•ã€‚è¿è¡ŒæˆåŠŸå¹¶èƒ½å¾—åˆ°scoreåï¼Œç„¶åæ‰ä¼šå»çœŸæ­£çš„æµ‹è¯•é›†ä¸Šè¿è¡Œå¹¶è¯„åˆ†ã€‚ç¬¬äºŒé˜¶æ®µçš„æ‰€æœ‰è¾“å‡ºå’Œæ‰“å°ä¿¡æ¯ä½ å…¨éƒ¨æ— æ³•çœ‹åˆ°ã€‚**

lightglue baseline + PCA 192
~~~
Dataset "ETs" -> Registered 21 / 22 images with 1 clusters
Dataset "amy_gardens" -> Failed!
Dataset "fbk_vineyard" -> Failed!
Dataset "imc2023_haiper" -> Failed!
Dataset "imc2023_heritage" -> Failed!
Dataset "imc2023_theather_imc2024_church" -> Failed!
Dataset "imc2024_dioscuri_baalshamin" -> Failed!
Dataset "imc2024_lizard_pond" -> Failed!
Dataset "pt_brandenburg_british_buckingham" -> Failed!
Dataset "pt_piazzasanmarco_grandplace" -> Failed!
Dataset "pt_sacrecoeur_trevi_tajmahal" -> Failed!
Dataset "pt_stpeters_stpauls" -> Failed!
Dataset "stairs" -> Registered 66 / 51 images with 3 clusters

~~~


mst + cluster dropout + too far from center remove
~~~
Dataset ETs -> Registered 19 / 22 images with 2 clusters
Dataset stairs -> Registered 37 / 51 images with 3 clusters
~~~

åšä¸ªå®éªŒéªŒè¯ä¸€ä¸‹æˆ‘çš„çŒœæƒ³ï¼Œé‡å†™is_trainä¸ºFalseæ—¶çš„æ•°æ®å¤„ç†ï¼Œä¸å†åŠ è½½sample_test_submission.csv. è€Œæ˜¯ä½¿ç”¨osæ‰«æç›®å½•, ç„¶åç”Ÿæˆæ–°çš„csvæ–‡ä»¶ã€‚

ç»“æ„å¦‚å®˜æ–¹sample_submission.csvä¸€è‡´

![](/assets/img/2025-05-15-17-18-45.png)

~~~

if is_train:
    sample_submission_csv = os.path.join(data_dir, 'train_labels.csv')
else:
    # æ³¨é‡Šæ‰åŸæœ¬çš„åŠ è½½sample_submission.csvçš„ä»£ç 
    # sample_submission_csv = os.path.join(data_dir, 'sample_submission.csv')
    # ä½¿ç”¨osæ‰«ædata_dir/test/ä¸‹çš„æ‰€æœ‰æ–‡ä»¶,
    # ç»“æ„ä¸º
    # |-data_dir
    #   |-test
    #     |-dataset1
    #       |-image1.jpg/png
    #       |-image2.jpg/png
    #       ...
    #     |-dataset2
    #       |-image1.jpg/png
    # å°†ç»“æœç”Ÿæˆä¸€ä¸ªmy_test_submission.csvæ–‡ä»¶
    # csvç¬¬ä¸€è¡Œå†™å…¥5åˆ—çš„åå­—: image_id	dataset	scene	image	rotation_matrix	translation_vector
    # ä¹‹åæ¯ä¸€è¡Œå†™å…¥ datasetå(dataset1, dataset2), dataset(èšç±»ç»“æœï¼Œé»˜è®¤cluster0), imageä¸ºå›¾åƒå, rotation_matrixé»˜è®¤ä¸º nan,nan,nan,nan,nan,nan,nan,nan,nan translation_vectoré»˜è®¤ä¸ºnan,nan,nan
    test_dir = os.path.join(data_dir, "test")
    sample_submission_csv = os.path.join(workdir, "my_test_submission.csv")

    rows = []
    for dataset_name in sorted(os.listdir(test_dir)):
        dataset_path = os.path.join(test_dir, dataset_name)
        if not os.path.isdir(dataset_path):
            continue  # è·³è¿‡éç›®å½•æ–‡ä»¶
        # åªä¿ç•™å¸¸è§çš„å›¾åƒåç¼€
        img_files = [
            f for f in os.listdir(dataset_path)
            if f.lower().endswith((".jpg", ".jpeg", ".png"))
        ]
        for img in sorted(img_files):
            rows.append(
                {
                    "image_id": np.nan,                      # æµ‹è¯•é›†éšè—ï¼Œæ— éœ€å¡«å†™
                    "dataset": dataset_name,                 # æ•°æ®é›†åç§°ï¼ˆ=å­ç›®å½•åï¼‰
                    "scene": "cluster0",                     # é»˜è®¤å ä½ï¼Œå¯åç»­æ›¿æ¢ä¸ºçœŸå®èšç±»
                    "image": img,                            # å•çº¯çš„æ–‡ä»¶åï¼ˆä¸å«è·¯å¾„ï¼‰
                    "rotation_matrix": " ".join(["nan"] * 9),   # 9 Ã— nan
                    "translation_vector": " ".join(["nan"] * 3) # 3 Ã— nan
                }
            )

    # æŒ‰å®˜æ–¹åˆ—é¡ºåºä¿å­˜
    df = pd.DataFrame(
        rows,
        columns=[
            "image_id",
            "dataset",
            "scene",
            "image",
            "rotation_matrix",
            "translation_vector",
        ],
    )
    df.to_csv(sample_submission_csv, index=False)
    print(f"Generated test submission file with {len(df)} rows â†’ {sample_submission_csv}")
~~~

## å¯è§†åŒ–

å¯è§†åŒ–ä»£ç  :arrow_right: [CODE](https://github.com/winka9587/vision_tool/blob/master/visualize_cams_align.py)

CSV æ–‡ä»¶ä¸­ä¿å­˜çš„æ˜¯ä¸–ç•Œåæ ‡ç³»åˆ°ç›¸æœºåæ ‡ç³»çš„å˜æ¢ï¼ˆWorld2Camï¼‰ï¼Œåœ¨å¯è§†åŒ–æ—¶ï¼ˆä¹˜ä»¥æœ€ä¼˜åŒ¹é…å‰ï¼‰éœ€è¦è½¬æ¢ä¸ºç›¸æœºåæ ‡ç³»åˆ°ä¸–ç•Œåæ ‡ç³»çš„å˜æ¢ï¼ˆCam2Worldï¼‰ã€‚

$$ \mathbf{R}_{w2c}, \mathbf{t}_{w2c} = \text{Load}(\texttt{submission.csv}) $$

$$ \mathbf{R}_{c2w} = \mathbf{R}_{w2c}^\top $$

$$ \mathbf{t}_{c2w} = -\mathbf{R}_{w2c}^\top \mathbf{t}_{w2c} $$

$$ [\mathbf{R}_{\text{aligned}} \mid \mathbf{t}_{\text{aligned}}] = \mathbf{T}_{\text{best}} [\mathbf{R}_{c2w} \mid \mathbf{t}_{c2w}] $$

## å…³äºMetricçš„ä¸€äº›éªŒè¯ä¸æ€è€ƒ

å•ä¸ªsceneçš„mAAçš„è®¡ç®—æ–¹å¼å¦‚ä¸‹:

![](/assets/img/2025-05-27-14-23-47.png)

å…¶ä¸­çš„top_decé»˜è®¤ä¸º3, å¾—åˆ†æœ€é«˜çš„3ä¸ªcameraè¢«æ’é™¤

___

é€‰æ‹©äº†ETsæ•°æ®é›†(åœ¨3ç§pipelineä¸‹çš„clusterç²¾åº¦éƒ½æ˜¯100%ï¼Œæ’é™¤èšç±»çš„å¹²æ‰°)

æœ€ä¼˜åŒ¹é…å˜æ¢transfæ¥è‡ªscoreå‡½æ•°. ä¿è¯æ­£ç¡®æ€§ã€‚

**DINOv2+ALIKED+Lightglue Baseline**

~~~
ETs: score=44.78% (mAA=28.85%, clusterness=100.00%)

ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| another_et_another_et001.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.04 |  16.67 |
| another_et_another_et002.png|  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| another_et_another_et003.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.06 |   0.00 |
| another_et_another_et004.png|  âŒ     âŒ     âŒ     âŒ     âœ…     âœ…   |   0.02 |  33.33 |
| another_et_another_et005.png|  âŒ     âŒ     âŒ     âœ…     âœ…     âœ…   |   0.01 |  50.00 |
| another_et_another_et006.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.09 |   0.00 |
| another_et_another_et007.png|  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| another_et_another_et008.png|  âŒ     âŒ     âœ…     âœ…     âœ…     âœ…   |   0.01 |  66.67 |
| another_et_another_et009.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.06 |   0.00 |
| another_et_another_et010.png|  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
âœ… Scene mAA for ETs/another_ET: 35.71%

ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| et_et000.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.07 |   0.00 |
| et_et001.png            |  âŒ     âŒ     âœ…     âœ…     âœ…     âœ…   |   0.01 |  66.67 | âœ… Removed
| et_et002.png            |  âŒ     âŒ     âœ…     âœ…     âœ…     âœ…   |   0.01 |  66.67 | âœ… Removed
| et_et003.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.12 |   0.00 |
| et_et004.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.07 |   0.00 |
| et_et005.png            |  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| et_et006.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.04 |  16.67 |
| et_et007.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.10 |   0.00 |
| et_et008.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.08 |   0.00 |
âœ… Scene mAA for ETs/ET: 4.17%
~~~

**MASt3R**

~~~
ETs: score=40.00% (mAA=25.00%, clusterness=100.00%)

ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| another_et_another_et001.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.05 |   0.00 |
| another_et_another_et002.png|  âŒ     âŒ     âŒ     âŒ     âœ…     âœ…   |   0.02 |  33.33 |
| another_et_another_et003.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.03 |  16.67 |
| another_et_another_et004.png|  âŒ     âŒ     âŒ     âŒ     âœ…     âœ…   |   0.02 |  33.33 |
| another_et_another_et005.png|  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| another_et_another_et006.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.13 |   0.00 |
| another_et_another_et007.png|  âŒ     âŒ     âŒ     âŒ     âœ…     âœ…   |   0.01 |  33.33 | âœ… Removed
| another_et_another_et008.png|  âŒ     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 |  83.33 | âœ… Removed
| another_et_another_et009.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.03 |  16.67 |
| another_et_another_et010.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.15 |   0.00 |
âœ… Scene mAA for ETs/another_ET: 21.43%

ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| et_et000.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.08 |   0.00 |
| et_et001.png            |  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| et_et002.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.03 |  16.67 |
| et_et003.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.06 |   0.00 |
| et_et004.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.06 |   0.00 |
| et_et005.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.02 |  16.67 |
| et_et006.png            |  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| et_et007.png            |  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| et_et008.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.10 |   0.00 |
âœ… Scene mAA for ETs/ET: 8.33%
~~~

**MASt3R+BA**

~~~
ETs: score=42.42% (mAA=26.92%, clusterness=100.00%)

ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| another_et_another_et001.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.05 |   0.00 |
| another_et_another_et002.png|  âŒ     âŒ     âŒ     âœ…     âœ…     âœ…   |   0.01 |  50.00 | âœ… Removed
| another_et_another_et003.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.04 |   0.00 |
| another_et_another_et004.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.04 |  16.67 |
| another_et_another_et005.png|  âŒ     âŒ     âŒ     âœ…     âœ…     âœ…   |   0.01 |  50.00 | âœ… Removed
| another_et_another_et006.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.13 |   0.00 |
| another_et_another_et007.png|  âŒ     âŒ     âŒ     âŒ     âœ…     âœ…   |   0.01 |  33.33 |
| another_et_another_et008.png|  âŒ     âŒ     âŒ     âŒ     âœ…     âœ…   |   0.02 |  33.33 |
| another_et_another_et009.png|  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| another_et_another_et010.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.12 |   0.00 |
âœ… Scene mAA for ETs/another_ET: 17.86%

 Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| et_et000.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.07 |   0.00 |
| et_et001.png            |  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| et_et002.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.03 |  16.67 |
| et_et003.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.06 |   0.00 |
| et_et004.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.06 |   0.00 |
| et_et005.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.02 |  16.67 |
| et_et006.png            |  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| et_et007.png            |  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| et_et008.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.10 |   0.00 |
âœ… Scene mAA for ETs/ET: 8.33%
~~~

**MASt3R + BA + shared_intrinsics=Fase**

ETs: score=7.41% (mAA=3.85%, clusterness=100.00%)

**VGGT**

~~~
ETs: score=14.29% (mAA=7.69%, clusterness=100.00%)

ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| another_et_another_et001.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.10 |   0.00 |
| another_et_another_et002.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.07 |   0.00 |
| another_et_another_et003.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.04 |   0.00 |
| another_et_another_et004.png|  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| another_et_another_et005.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.10 |   0.00 |
| another_et_another_et006.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.16 |   0.00 |
| another_et_another_et007.png|  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| another_et_another_et008.png|  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
| another_et_another_et009.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.05 |   0.00 |
| another_et_another_et010.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.14 |   0.00 |
âœ… Scene mAA for ETs/another_ET: 0.00%

ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| et_et000.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.14 |   0.00 |
| et_et001.png            |  âŒ     âŒ     âœ…     âœ…     âœ…     âœ…   |   0.01 |  66.67 | âœ… Removed
| et_et002.png            |  âŒ     âŒ     âŒ     âœ…     âœ…     âœ…   |   0.01 |  50.00 | âœ… Removed
| et_et003.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.19 |   0.00 |
| et_et004.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.12 |   0.00 |
| et_et005.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.07 |   0.00 |
| et_et006.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.11 |   0.00 |
| et_et007.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   0.06 |   0.00 |
| et_et008.png            |  âœ…     âœ…     âœ…     âœ…     âœ…     âœ…   |   0.00 | 100.00 | âœ… Removed
âœ… Scene mAA for ETs/ET: 0.00%
~~~

### æ— ä¸‰è§’åŒ–BA

è®°å½•å¯¹æ¯”ï¼Œä»¥æ£€æŸ¥æ˜¯å¦æœ‰æå‡

~~~
ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| another_et_another_et001.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.38 |   0.00 |
| another_et_another_et002.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.13 |   0.00 |
| another_et_another_et004.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.13 |   0.00 |
| another_et_another_et005.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.14 |   0.00 |
| another_et_another_et006.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   1.32 |   0.00 | âœ… Removed
| another_et_another_et007.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   1.36 |   0.00 | âœ… Removed
| another_et_another_et008.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.25 |   0.00 |
| another_et_another_et009.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   5.04 |   0.00 |
| another_et_another_et010.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   7.41 |   0.00 |
âœ… Scene mAA for ETs/another_ET: 0.00%
~~~
~~~
ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| et_et000.png            |  âŒ     âŒ     âŒ     âŒ     âœ…     âœ…   |   0.01 |  33.33 | âœ… Removed
| et_et001.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   7.32 |   0.00 |
| et_et002.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.45 |   0.00 |
| et_et003.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   9.96 |   0.00 |
| et_et004.png            |  âŒ     âŒ     âŒ     âŒ     âœ…     âœ…   |   0.02 |  33.33 | âœ… Removed
| et_et005.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   7.35 |   0.00 |
| et_et006.png            |  âŒ     âŒ     âœ…     âœ…     âœ…     âœ…   |   0.01 |  66.67 | âœ… Removed
| et_et007.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   2.35 |   0.00 |
| et_et008.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   9.09 |   0.00 |
âœ… Scene mAA for ETs/ET: 0.00%
~~~
### ä¿®æ­£ä¸‰è§’åŒ–BA

~~~
ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| another_et_another_et001.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.38 |   0.00 |
| another_et_another_et002.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.13 |   0.00 |
| another_et_another_et003.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   2.97 |   0.00 | âœ… Removed
| another_et_another_et004.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.13 |   0.00 |
| another_et_another_et005.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.14 |   0.00 |
| another_et_another_et006.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   1.32 |   0.00 | âœ… Removed
| another_et_another_et007.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   1.36 |   0.00 | âœ… Removed
| another_et_another_et008.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.25 |   0.00 |
| another_et_another_et009.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   5.04 |   0.00 |
| another_et_another_et010.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   7.41 |   0.00 |
âœ… Scene mAA for ETs/another_ET: 0.00%
~~~

~~~
ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| et_et000.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.18 |   0.00 |
| et_et001.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.13 |   0.00 | âœ… Removed
| et_et002.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   2.61 |   0.00 | âœ… Removed
| et_et003.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.68 |   0.00 |
| et_et004.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   2.38 |   0.00 | âœ… Removed
| et_et005.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.33 |   0.00 |
| et_et006.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.54 |   0.00 |
| et_et007.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   5.39 |   0.00 |
| et_et008.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   7.13 |   0.00 |
âœ… Scene mAA for ETs/ET: 0.00%
~~~

![](/assets/img/2025-05-11-22-21-54.png)


![](/assets/img/2025-05-11-22-22-07.png)

![](/assets/img/2025-05-11-22-22-25.png)

![](/assets/img/2025-05-11-22-22-53.png)

### BA æ— æ•ˆä¸‰è§’åŒ– inv(å¯¹ä¿å­˜çš„RTæ±‚é€†)

~~~
 Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| another_et_another_et001.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.38 |   0.00 |
| another_et_another_et002.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.13 |   0.00 |
| another_et_another_et003.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   2.97 |   0.00 | âœ… Removed
| another_et_another_et004.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.13 |   0.00 |
| another_et_another_et005.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.14 |   0.00 |
| another_et_another_et006.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   1.32 |   0.00 | âœ… Removed
| another_et_another_et007.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   1.36 |   0.00 | âœ… Removed
| another_et_another_et008.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.25 |   0.00 |
| another_et_another_et009.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   5.04 |   0.00 |
| another_et_another_et010.png|  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   7.41 |   0.00 |
âœ… Scene mAA for ETs/another_ET: 0.00%
~~~

~~~
ğŸ“Š Per-image registration table:
| Image Name              |  0.00   0.01   0.01   0.01   0.02   0.04 | Error  | mAA (%) | Removed?
--------------------------------------------------------------------------------------------------
| et_et000.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   9.78 |   0.00 |
| et_et001.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.02 |  16.67 | âœ… Removed
| et_et002.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   5.99 |   0.00 |
| et_et003.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.31 |   0.00 |
| et_et004.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âœ…   |   0.03 |  16.67 | âœ… Removed
| et_et005.png            |  âŒ     âŒ     âŒ     âŒ     âœ…     âœ…   |   0.01 |  33.33 | âœ… Removed
| et_et006.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   4.57 |   0.00 |
| et_et007.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   7.92 |   0.00 |
| et_et008.png            |  âŒ     âŒ     âŒ     âŒ     âŒ     âŒ   |   3.69 |   0.00 |
âœ… Scene mAA for ETs/ET: 0.00%
~~~

![](/assets/img/2025-05-11-22-23-35.png)

![](/assets/img/2025-05-11-22-24-05.png)

![](/assets/img/2025-05-11-22-25-43.png)

## å…³äºmast3rå’ŒVGGT baselineçš„ä¸€äº›åˆ†æ

åªèƒ½æ¢å¤ç›¸å¯¹å°ºåº¦ï¼Œç¼ºå°‘ç»å¯¹è·ç¦»çº¦æŸã€‚

metricä¸­çš„Horn +RANSACèƒ½å¤Ÿåšä¸€æ¬¡ç›¸ä¼¼å˜æ¢ï¼Œè¯¥å˜æ¢åªåº”ç”¨åˆ°ç›¸æœºçš„ä¸­å¿ƒï¼Œå¹¶ä¸”å¯¹æç«¯çš„outlieræ•æ„Ÿã€‚

local BAçš„å‚æ•°ä¸å¤Ÿ

### å…³äºcv.findFundamentalMat

https://docs.opencv.org/4.x/d9/d0c/group__calib3d.html

![](/assets/img/2025-05-27-16-28-29.png)

### å…³äºscoreä¸­çš„éšæœºæ€§

æ¥è‡ªäºcolmap

![](/assets/img/2025-05-28-17-21-04.png)

~~~
It was pointed out that this randomness comes from the reconstruction process. You need to set "num_threads": 1 in pycolmap.IncrementalPipelineOptions to stabilize the result for submission.
Ref: https://www.kaggle.com/competitions/image-matching-challenge-2024/discussion/494921
~~~